KISSY.add("mv/main",function(t,e,i,e,r,a,n,s,o,l,h,u,f,c,d,p){var m=Hilo.Stage;var _=Hilo.Container;var v=Hilo.Bitmap;var g=Hilo.Ticker;var y=Hilo.Tween;var w=Hilo.LoadQueue;var b=window.main={timeline:h,task:f,isLoaded:false,isLoading:false,init:function(e){var i=this;l.init(e);n.getAvatars(function(e){t.each(e,function(t){t.noPrePath=true});o.setTextures(e[0].clothing);o.add(e.slice(0,l.peopleNum));i._init()})},_init:function(){var t={width:l.game.width,height:l.game.height,scaleX:l.game.scale,scaleY:l.game.scale};this.elem=i.get("#gameContainer");if(l.game.isCanvas){t.container=this.elem}else{t.canvas=this.elem}var e=this.stage=new m(t);var r=this.ticker=new g(l.urlKey.fps||30);r.addTick(e);r.addTick(y);r.addTick(h);if(l.urlKey.showFps){r.addTick(s);s.start()}r.start(false);this.bindEvent();d.init(this);if(l.mobile){i.css("#mvContainer","background","center center no-repeat");i.css("#mvContainer","backgroundImage","url("+l.path+"img/mv/bg.jpg)");i.css("#mvContainer","backgroundSize","auto 100%");i.css("#mvContainer","backgroundColor","#000")}else{i.css("#mvContainer","backgroundColor","#000")}this.isUserinfoLoaded=true;if(l.autoplay){this.play()}},load:function(){if(!this.isLoading){this.isLoading=true;o.load()}},bindEvent:function(){var r=this;a.on("gameLoadComplete",function(){r.initGame()});if(l.mobile){if(Ali.appinfo.name.indexOf("tmal")>-1&&TMM&&TMM.APP&&TMM.APP.call){TMM.APP.call("PageVisibility.watchVisibilitychange",[1],function(t){if(t&&t.data){if(!t.data.visible&&r.isPlay){r.stop()}}})}else if(Ali.appinfo.name.indexOf("taobao")>-1){document.addEventListener("WV.Event.APP.Background",function(t){r.stop()},false)}}else{}e.on("#mvContainer","click",function(){if(r.isPlay){r.stop()}else{r.play()}});e.delegate("#mv-ui","click",".mv-btn",function(t){t.halt();var e=t.currentTarget;switch(i.attr(e,"data-event")){case"play":if(r.isPlay){r.stop()}else{r.play()}break;case"fullscreen":if(l.fullscreen){Ali.showTitle();history.back()}else{d.setScreen(!d.isFullscreen)}break;case"share":p.share();break}});if(t.UA.ie&&t.UA.ie<=8){document.body.onclick=function(){if(r.isPlay){r.stop()}else{r.play()}return false}}},initGame:function(){var e=this.players=[];var a=0;var n=["p0","p1","p2","p3","p4"];function s(t,i,r){r*=1;var s=new u;s.createArmature(n[a]);s.setArmature(n[a]);s.setDisplayProps({scaleX:r,scaleY:r,x:t+l.game.width*.5+30,y:i+6});e.push(s);s.startX=t;s.startY=i;s.play("C");if(o.getNeedZ(n[a])){s.armature.getSlot("torso down.png").setZOrder(20)}a++;return s}var h=[[0,360,.55],[-120,350,.5],[135,350,.5],[-240,340,.45],[250,340,.45]];t.each(h,function(t,e){if(e<l.peopleNum){s.apply(this,t)}});var c=this.scene=new _({pivotX:l.game.width*.5,pivotY:l.game.height-200,x:l.game.width*.5,y:l.game.height-200});c.startX=c.x;c.startY=c.y;this.stage.addChild(c);this.bg=r;r.init(this.scene);f.init(b);this.isLoaded=true;this._play();if(l.mobile){i.css("#mvContainer","background","#000")}},stop:function(t){if(this.isPlay){this.isPlay=false;d.setPlayBtn(true);if(!t){o.get("audio").pause()}this.ticker._tick(1);this.ticker.stop()}},resume:function(){if(!this.isEnd){this.play()}},play:function(){if(!this.isUserinfoLoaded){l.autoplay=t.UA.ipad?false:true}else if(this.isEnd){d.setPlayBtn(false);this.replay()}else if(!this.isPlay){d.setPlayBtn(false);this.isPlay=true;if(!this.isLoaded){this.load(true)}else{o.get("audio").resume();this.ticker.start()}}},_play:function(){var t=this;h.resetTask();h.addTask(f.getTasks());h.start(-.5);h.on("end",function(){t.isEnd=true;t.stop(true)})},replay:function(){this.isEnd=false;this.isPlay=true;f.reset();h.start(.65);this.ticker.start();o.get("audio").play()}};return b},{requires:["event","dom","event","mv/bg","mv/mediator","mv/model","mv/fps","mv/resource","mv/config","mv/timeline","mv/role","mv/task","mv/loading","mv/control","mv/utils"]});