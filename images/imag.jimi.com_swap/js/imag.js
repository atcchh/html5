(function(){"use strict";function e(e,t){if(e&&t)for(var n in t)e[n]=t[n]}var t=Math,n=function(){for(var e="msT,webkitT,MozT,OT,t".split(","),t=0;e.length>t;t++){var n=e[t]+"ransform";if(n in document.documentElement.style)return n}}(),o="ontouchstart"in window,i="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,s=!!n,a=s,r="translate"+(i?"3d(":"("),l=i?",0)":")",c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,20)}}(),u=function(){return window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),h="onorientationchange"in window?"orientationchange":"resize",p=o?"touchstart":"mousedown",g=o?"touchmove":"mousemove",d=o?"touchend":"mouseup",f=o?"touchcancel":"mouseup",m=o?"":"mouseout",v=function(t,n){var i=this,r=document;if(i.wrapper=r.querySelector(t),i.wrapper.style.overflow="hidden",i.options={x:0,y:0,bounce:!0,momentum:!0,useTransform:!0,pageDefinitions:null,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onBeforePageChange:null,onPageChange:null},e(i.options,n),a=s?i.options.useTransform:!1,i.slider=r.querySelector(t+" > div"),i.pages=r.querySelectorAll(t+" > div > div"),i.options.pageDefinitions)for(var l=0;i.pages.length>l;l++){var c=i.pages[l];e(c,{isLoaded:!1,onInit:function(){},onShow:function(){},onLeave:function(){},index:l}),e(c,i.options.pageDefinitions.defaultSettings),e(c,i.options.pageDefinitions[l])}i.x=i.options.x,i.y=i.options.y,i.slider.style.width=i.pages.length*i.pages[0].clientWidth+"px",i.currentPage=-1,i.lastPage=-1,i.enabled=!0,i.pageChangeFlag=!0,i.steps=[],i._bind(h,window),i._bind(p),i._bind("click",i.wrapper,!0),o||i._bind("mouseout",i.wrapper),i.changeToPage(0)};v.prototype={handleEvent:function(e){switch(e.type){case p:if(!o&&0!==e.button)return;this._start(e);break;case g:this._move(e);break;case d:this._end(e,"end");break;case f:this._end(e,"cancel");break;case h:this._resize();break;case m:this._mouseout(e);break;case"click":this._click(e)}},_resize:function(){this.refresh()},_pos:function(){return a?function(e,t,o){this.slider.style[n]=r+e+"px,0"+l,o||(this.scroller.style[n]=r+"0,"+t+"px"+l),this.x=e,this.y=t}:function(e,n,o){this.slider.style.left=t.round(e)+"px",o||(n=t.round(n),this.scroller.style.top=n+"px"),this.x=e,this.y=n}}(),_start:function(e){var t,i,s,r=this,l=o?e.touches[0]:e;if(r.enabled&&!r.touch){if(-1!==$.inArray(e.target.tagName.toLowerCase(),["select","input","textarea"]))return e.stopPropagation(),void 0;r.options.onBeforeScrollStart&&r.options.onBeforeScrollStart.call(r,e),r.moved=!1,r.animating=!1,r.distX=0,r.distY=0,r.absDistX=0,r.absDistY=0,r.dirX=0,r.dirY=0,r.touch=!0,r.scrollerH=r._getScrollerH(),r._pageChanging&&(r._firePageChangeEvent(),r.options.onPageChange&&r.options.onPageChange.call(r,r.lastPage,r.currentPage),r._pageChanging=!1),r.options.momentum&&(a?(t=getComputedStyle(r.slider,null)[n].replace(/[^0-9-.,]/g,"").split(","),i=1*t[4],t=getComputedStyle(r.scroller,null)[n].replace(/[^0-9-.,]/g,"").split(","),s=1*t[5]):(i=1*getComputedStyle(r.slider,null).left.replace(/[^0-9-]/g,""),s=1*getComputedStyle(r.scroller,null).top.replace(/[^0-9-]/g,"")),(i!=r.x||s!=r.y)&&(u(r.aniTime),r.steps=[],r._pos(i,s))),r.absStartX=r.x,r.absStartY=r.y,r.startX=r.x,r.startY=r.y,r.pointX=l.pageX,r.pointY=l.pageY,r.startTime=e.timeStamp||Date.now(),r.options.onScrollStart&&r.options.onScrollStart.call(r,e),r._bind(g),r._bind(d),r._bind(f)}},_move:function(e){var n=this,i=o?e.touches[0]:e,s=i.pageX-n.pointX,a=i.pageY-n.pointY,r=n.x+s,l=n.y+a,c=e.timeStamp||Date.now();if(n.options.onBeforeScrollMove&&n.options.onBeforeScrollMove.call(n,e),n.pointX=i.pageX,n.pointY=i.pageY,8>n.absDistX&&8>n.absDistY)return n.distX+=s,n.distY+=a,n.absDistX=t.abs(n.distX),n.absDistY=t.abs(n.distY),void 0;(r>0||n.maxScrollX>r)&&(r=n.options.bounce?n.x+s/2:r>=0||n.maxScrollX>=0?0:n.maxScrollX);var u=n.maxScrollY();(l>0||u>l)&&(l=n.options.bounce?n.y+a/2:l>=0||u>=0?0:u),n.absDistX>n.absDistY?(l=n.y,a=0):(r=n.x,s=0),n.pageChangeFlag||(r=n.x),n._pos(r,l),n.moved=!0,n.dirX=s>0?-1:0>s?1:0,n.dirY=a>0?-1:0>a?1:0,c-n.startTime>300&&(n.startTime=c,n.startX=n.x,n.startY=n.y),n.options.onScrollMove&&n.options.onScrollMove.call(n,e)},_end:function(e){if(!o||0==e.touches.length){var n,i,s,a=this,r=o?e.changedTouches[0]:e,l={dist:0,time:0},c=(e.timeStamp||Date.now())-a.startTime,u=(a.x,a.y);if(a.touch=!1,a._unbind(g),a._unbind(d),a._unbind(f),a.options.onBeforeScrollEnd&&a.options.onBeforeScrollEnd.call(a,e),!a.moved&&!a.animating&&o&&-1==$.inArray(e.target.tagName.toLowerCase(),["select","input","textarea"])){for(n=r.target;1!=n.nodeType;)n=n.parentNode;var i=document.createEvent("MouseEvents");return i.initMouseEvent("click",!0,!0,e.view,1,r.screenX,r.screenY,r.clientX,r.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,!0),i._fake=!0,n.dispatchEvent(i),a._resetPos(0),a.options.onTouchEnd&&a.options.onTouchEnd.call(a,e),void 0}var h=a.x- -a.currentPage*a.pageWidth;if(0!=h&&t.abs(h)>=1){var p=30>t.abs(h)?a.currentPage:a.currentPage+(h>0?-1:1);return a.changeToPage(p),void 0}if(a.dirY&&300>c&&a.options.momentum&&(l=u?a._momentum(u-a.startY,c,-a.y,0>a.maxScrollY()?a.scrollerH-a.wrapperH+a.y:0,a.options.bounce?a.wrapperH:0):l,u=a.y+l.dist,(a.y>0&&u>0||a.y<a.maxScrollY()&&a.maxScrollY()>u)&&(l={dist:0,time:0})),l.dist)return s=t.max(l.time,10),a.scrollTo(a.x,t.round(u),s),a.options.onTouchEnd&&a.options.onTouchEnd.call(a,e),void 0;a.moved&&a._resetPos(200),a.options.onTouchEnd&&a.options.onTouchEnd.call(a,e)}},_click:function(e){(this.moved||this.animating)&&e.stopPropagation()},_resetPos:function(e){var t=this.maxScrollY(),n=this,o=n.x>=0?0:n.x<n.maxScrollX?n.maxScrollX:n.x,i=n.y>=0||t>0?0:t>n.y?t:n.y;return o==n.x&&i==n.y?(n.moved&&(n.options.onScrollEnd&&n.options.onScrollEnd.call(n),n.moved=!1),void 0):(n.scrollTo(o,i,e||0,!1,!1),void 0)},_mouseout:function(e){var t=e.relatedTarget;if(!t)return this._end(e),void 0;for(;t=t.parentNode;)if(t==this.wrapper)return;this._end(e)},_startAni:function(e,n){var o,i,s,a=this,r=a.x,l=a.y,u=Date.now();if(!a.animating){if(!a.steps.length)return a._resetPos(400,e),n&&n(),void 0;o=a.steps.shift(),o.x==r&&o.y==l&&(o.time=0),a.animating=!0,s=function(){var h,p,g=Date.now();return g>=u+o.time?(a._pos(o.x,o.y,e),a.animating=!1,a._startAni(e,n),void 0):(g=(g-u)/o.time-1,i=t.sqrt(1-g*g),h=(o.x-r)*i+r,p=(o.y-l)*i+l,a._pos(h,p,e),a.animating&&(a.aniTime=c(s)),void 0)},s()}},_momentum:function(e,n,o,i,s){var a=6e-4,r=t.abs(e)/n,l=r*r/(2*a),c=0,u=0;return e>0&&l>o?(u=s/(6/(l/r*a)),o+=u,r=r*o/l,l=o):0>e&&l>i&&(u=s/(6/(l/r*a)),i+=u,r=r*i/l,l=i),l*=0>e?-1:1,c=r/a,{dist:l,time:t.round(c)}},_bind:function(e,t,n){(t||this.wrapper).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.wrapper).removeEventListener(e,this,!!n)},changeToPage:function(e,t){if(this.pageChangeFlag){var o=this;e=0>=e?0:e>o.pageCount-1?o.pageCount-1:e;var i=o.pages[e];if(i){o.stop(),o.options.onBeforePageChange&&o.options.onBeforePageChange.call(o,o.lastPage,e),o.lastPage=o.currentPage,o.currentPage=e,o.scroller=i;var s=getComputedStyle(o.scroller,null)[n].replace(/[^0-9-.,]/g,"").split(",");o.y=1*s[5]||0,a?(i.style[n+"Origin"]="0 0",i.style[n]=r+"0,"+o.y+"px"+l):(i.style.top=o.y+"px",i.style.left="0px"),o.refresh(),o._pageChanging=!0,o.scrollTo(-o.currentPage*o.pageWidth,o.y,t?1:300,!1,!0,function(){o._pageChanging=!1,o._firePageChangeEvent(),o.options.onPageChange&&o.options.onPageChange.call(o,o.lastPage,o.currentPage)})}}},_firePageChangeEvent:function(){var e=this.getPage(this.lastPage),t=this.getPage(this.currentPage);e&&e.onLeave.call(e),t&&(t.isLoaded?t.onShow.call(t):(t.onInit.call(t),t.isLoaded=!0,t.onShow.call(t)))},getPage:function(e){return this.pages[e]},getTotalPages:function(){return this.pages},refresh:function(){var e=this;e.wrapperW=e.wrapper.clientWidth,e.wrapperH=e.wrapper.clientHeight,e.pageWidth=e.pages[0].offsetWidth,e.pageCount=e.pages.length,e.scrollerW=e.pageCount*e.pageWidth,e.scrollerH=e._getScrollerH(),e.maxScrollX=e.wrapperW-e.scrollerW,e.dirX=0,e.dirY=0,e._resetPos(200)},_getScrollerH:function(){return Math.max(this.scroller.scrollHeight,this.wrapperH)},maxScrollY:function(){return this.wrapperH-this.scrollerH},scrollTop:function(e){this.scrollTo(this.x,isNaN(e)?0:e,0)},scrollTo:function(e,t,n,o,i,s){var a=this,r=e;a.stop(),r.length||(r=[{x:e,y:t,time:n,relative:o}]);for(var l=0,c=r.length;c>l;l++)r[l].relative&&(r[l].x=a.x-r[l].x,r[l].y=a.y-r[l].y),a.steps.push({x:r[l].x,y:r[l].y,time:r[l].time||0});a._startAni(i,s)},enablePageChange:function(e){this.pageChangeFlag=!!e},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(g),this._unbind(d),this._unbind(f)},enable:function(){this.enabled=!0},stop:function(){u(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},destroy:function(){this._unbind(h,window),this._unbind(p),this._unbind(g),this._unbind(d),this._unbind(f),this._unbind(m,that.wrapper),this.scroller.style[n]="",this.options.onDestroy&&that.options.onDestroy.call(that)}},"undefined"!=typeof exports?exports.iMAGViewer=v:window.iMAGViewer=v})();